# Anonymous Aggregate User Behaviour Analytics

Lumogon has begun gathering anonymous aggregate user behaviour analytics and reporting these to Google Analytics.

## Why?

We are interested in learning how users are succeeding in using Lumogon to
explore their container deployments. Gathering information on which lumogon
commands are being run, and how frequently, gives us a basic insight into what
features are the most used.  We're also interested in learning whether the
client tooling on its own is useful, or whether users are finding that
uploading container data to the reporting service for visualization has value
as well.  By collecting anonymous counts of these actions we have a starting
point to explore what is working or not working for users of the tool.  If our
statistics tell us that more reports are being uploaded than we receive then we
have an indication that our report viewer service is potentially not keeping up
with demand from users.

## What?
Lumogon's analytics record some shared information for every event:

- The Google Analytics version, i.e. `1` (https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters#v)
- The Lumogon analytics tracking ID, e.g. `UA-54263865-7` (https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters#tid)
- A Docker analytics user ID, e.g. `7TRN:IPZB:QYBB:VPBQ:UMPP:KARE:6ZNR:XE6T:7EWV:PKF4:ZOJD:TPYS`. This is generated by `docker`. This does not allow us to track individual users but does enable us to accurately measure user counts vs. event counts (https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters#cid)
- The Lumogon application name, e.g. `Lumogon` (https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters#an)
- The Lumogon application version, e.g. `1.0.0` (https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters#av)
- The Lumogon analytics hit type, e.g. `screenview` (https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters#t)
- The Lumogon analytics screen view, e.g. `list` (https://developers.google.com/analytics/devguides/collection/protocol/v1/parameters#cd)


Lumogon's analytics records the following different events:

- a `screenview` hit type with the official Lumogon command you have run (with arguments stripped), e.g. `lumogon capabilities`
- an `event` type that indicates that an upload to the report viewer service was at least attempted

You can disable any analytics from being set by setting the variable `LUMOGON_DISABLE_ANALYTICS=1` in your environment. It is impossible for the Lumogon developers to match any particular event to any particular user.


## When/Where?
Lumogon's analytics are sent throughout Lumogon's execution to Google Analytics over HTTPS.

## Who?

This anonymized statistics data is accessible to the Lumogon development team
at Puppet, Inc. We can look at trends in a standard Google Analytics dashboard
to get a sense of which commands are being run, and how often users are
attempting to upload reports to the report viewer service. This helps us focus
on popular features, as well as how much we should be focusing on scaling our
report viewer service.


## How?
The code is viewable in [analytics](https://github.com/puppetlabs/lumogon/blob/master/analytics/ga.go). They are done in a separate background process and fail fast to avoid delaying any execution. They will fail immediately and silently if you have no network connection.

## Opting out
Lumogon analytics helps us maintainers and leaving it on is appreciated. However, if you want to opt out of Lumogon's analytics, you can set this variable in your environment:

```sh
export LUMOGON_DISABLE_ANALYTICS=1
```

Alternatively, you can pass the following CLI argument at runtime

```sh
docker run --rm -v /var/run/docker.sock:/var/run/docker.sock local/lumogon --disable-analytics
```
